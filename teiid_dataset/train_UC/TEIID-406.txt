Extra commands for union are collected when the falg is set to embedded 
This is from a customer case (269005). CommandCollectorVisitor collects extra commands for the union when the flag is set to embedded only.